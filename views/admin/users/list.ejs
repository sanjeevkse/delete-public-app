<%- include('../../layout', { title: 'User Management', currentPage: 'users', body: `
<div class="page-header">
  <h1><i class="fas fa-users"></i> User Management</h1>
  <p>Manage system users and their profiles</p>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Users List</h5>
    <button class="btn btn-primary btn-sm" onclick="openCreateUserModal()">
      <i class="fas fa-plus"></i> New User
    </button>
  </div>
  <div class="card-body">
    <div class="mb-3">
      <input type="text" class="form-control" id="searchUsers" placeholder="Search users...">
    </div>
    <div id="usersTableContainer">
      <div class="text-center">
        <div class="loading"></div>
      </div>
    </div>
  </div>
</div>

<script>
  async function loadUsers() {
    try {
      const data = await fetchAPI(API_BASE + '/users?page=1&limit=50');
      const users = data.data || [];

      let html = '<table class="table table-hover">';
      html += '<thead><tr><th>ID</th><th>Contact</th><th>Name</th><th>Status</th><th>Created</th><th>Actions</th></tr></thead><tbody>';

      users.forEach(user => {
        const status = user.status === 1 ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-danger">Inactive</span>';
        const createdAt = new Date(user.createdAt).toLocaleDateString();
        html += '<tr>';
        html += '<td>' + user.id + '</td>';
        html += '<td>' + (user.contactNumber || '-') + '</td>';
        html += '<td>' + (user.profile?.name || '-') + '</td>';
        html += '<td>' + status + '</td>';
        html += '<td>' + createdAt + '</td>';
        html += '<td><button class="btn btn-sm btn-info" onclick="editUser(' + user.id + ')"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deleteUser(' + user.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
      });

      html += '</tbody></table>';
      if (users.length === 0) {
        html = '<p class="text-center text-muted">No users found</p>';
      }

      document.getElementById('usersTableContainer').innerHTML = html;
    } catch (error) {
      document.getElementById('usersTableContainer').innerHTML = '<p class="text-danger">Error loading users</p>';
    }
  }

  function openCreateUserModal() {
    alert('User creation would open a form modal. This is a placeholder.');
  }

  function editUser(id) {
    alert('Edit user ' + id);
  }

  function deleteUser(id) {
    if (confirm('Are you sure?')) {
      alert('Delete user ' + id);
    }
  }

  document.addEventListener('DOMContentLoaded', loadUsers);
</script>
` }) %>
