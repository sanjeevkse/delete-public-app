<%- include('../layout', { title: 'Dashboard', currentPage: 'dashboard', body: `
<div class="page-header">
  <h1><i class="fas fa-chart-line"></i> Dashboard</h1>
  <p>Welcome to the Admin Panel - System Overview</p>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3 mb-3">
    <div class="stat-card">
      <div class="stat-icon bg-primary">
        <i class="fas fa-users"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value"><%= stats.users %></div>
        <div class="stat-label">Total Users</div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="stat-card">
      <div class="stat-icon bg-success">
        <i class="fas fa-user-tie"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value"><%= stats.roles %></div>
        <div class="stat-label">Total Roles</div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="stat-card">
      <div class="stat-icon bg-info">
        <i class="fas fa-lock"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value"><%= stats.permissions %></div>
        <div class="stat-label">Permissions</div>
      </div>
    </div>
  </div>
  <div class="col-md-3 mb-3">
    <div class="stat-card">
      <div class="stat-icon bg-warning">
        <i class="fas fa-layer-group"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value"><%= stats.permissionGroups %></div>
        <div class="stat-label">Permission Groups</div>
      </div>
    </div>
  </div>
</div>

<!-- Main Content Row -->
<div class="row">
  <!-- Quick Actions -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h5 class="mb-0"><i class="fas fa-lightning-bolt"></i> Quick Actions</h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <a href="/admin/users" class="btn btn-outline-primary text-start d-flex align-items-center justify-content-between py-2">
            <span><i class="fas fa-user-plus me-2"></i> Manage Users</span>
            <i class="fas fa-arrow-right"></i>
          </a>
          <a href="/admin/roles" class="btn btn-outline-success text-start d-flex align-items-center justify-content-between py-2">
            <span><i class="fas fa-user-tie me-2"></i> Manage Roles</span>
            <i class="fas fa-arrow-right"></i>
          </a>
          <a href="/admin/permissions" class="btn btn-outline-info text-start d-flex align-items-center justify-content-between py-2">
            <span><i class="fas fa-lock me-2"></i> Manage Permissions</span>
            <i class="fas fa-arrow-right"></i>
          </a>
          <a href="/admin/permission-groups" class="btn btn-outline-warning text-start d-flex align-items-center justify-content-between py-2">
            <span><i class="fas fa-layer-group me-2"></i> Permission Groups</span>
            <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- System Status -->
  <div class="col-lg-6 mb-4">
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <h5 class="mb-0"><i class="fas fa-server"></i> System Status</h5>
      </div>
      <div class="card-body">
        <div class="row text-center">
          <div class="col-md-6 mb-3">
            <div class="status-item">
              <i class="fas fa-database text-success" style="font-size: 24px;"></i>
              <p class="mt-2 mb-0"><strong>Database</strong></p>
              <small class="text-success">Connected</small>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="status-item">
              <i class="fas fa-network-wired text-success" style="font-size: 24px;"></i>
              <p class="mt-2 mb-0"><strong>API</strong></p>
              <small class="text-success">Online</small>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="status-item">
              <i class="fas fa-clock text-info" style="font-size: 24px;"></i>
              <p class="mt-2 mb-0"><strong>Server Time</strong></p>
              <small id="serverTime" class="text-muted">--:--:--</small>
            </div>
          </div>
          <div class="col-md-6 mb-3">
            <div class="status-item">
              <i class="fas fa-heart text-danger" style="font-size: 24px;"></i>
              <p class="mt-2 mb-0"><strong>Health</strong></p>
              <small class="text-success">Healthy</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Recent Users -->
<div id="recentUsersContainer"></div>

<style>
  .stat-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    display: flex;
    align-items: center;
    gap: 15px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
  }

  .stat-value {
    font-size: 28px;
    font-weight: 700;
    color: #333;
  }

  .stat-label {
    font-size: 14px;
    color: #999;
  }

  .status-item {
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
    transition: background 0.3s ease;
  }

  .status-item:hover {
    background: #f0f2f5;
  }
</style>

<script>
  // Update server time
  function updateServerTime() {
    const now = new Date();
    document.getElementById('serverTime').textContent = now.toLocaleTimeString();
  }

  // Render recent users
  function renderRecentUsers() {
    const recentUsers = <%= JSON.stringify(recentUsers || []) %>;
    const container = document.getElementById('recentUsersContainer');
    
    if (!recentUsers || recentUsers.length === 0) {
      container.innerHTML = '';
      return;
    }

    let html = `
      <div class="row">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between align-items-center">
              <h5 class="mb-0"><i class="fas fa-history"></i> Recent Users</h5>
              <a href="/admin/users" class="btn btn-sm btn-primary">View All</a>
            </div>
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>Email</th>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Created</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
    `;

    recentUsers.forEach(user => {
      let statusBadge = 'bg-warning';
      if (user.status === 'active' || user.status === 1) statusBadge = 'bg-success';
      else if (user.status === 'inactive' || user.status === 0) statusBadge = 'bg-secondary';
      
      const statusText = user.status === 'active' || user.status === 1 ? 'Active' : (user.status === 'inactive' || user.status === 0 ? 'Inactive' : 'Pending');
      const createdDate = new Date(user.createdAt).toLocaleDateString();
      
      html += `
                  <tr>
                    <td>${user.email || '-'}</td>
                    <td>${(user.firstName || '') + ' ' + (user.lastName || '')}</td>
                    <td><span class="badge ${statusBadge}">${statusText}</span></td>
                    <td>${createdDate}</td>
                    <td>
                      <a href="/admin/users/${user.id}/edit" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i>
                      </a>
                    </td>
                  </tr>
      `;
    });

    html += `
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    `;

    container.innerHTML = html;
  }

  // Update time every second
  updateServerTime();
  setInterval(updateServerTime, 1000);
  
  // Render users on page load
  document.addEventListener('DOMContentLoaded', renderRecentUsers);
</script>
` }) %>
