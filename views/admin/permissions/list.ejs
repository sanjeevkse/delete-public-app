<%- include('../../layout', { title: 'Permission Management', currentPage: 'permissions', body: `
<div class="page-header">
  <h1><i class="fas fa-lock"></i> Permission Management</h1>
  <p>Manage system permissions</p>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Permissions</h5>
    <button class="btn btn-primary btn-sm" onclick="openCreatePermissionModal()">
      <i class="fas fa-plus"></i> New Permission
    </button>
  </div>
  <div class="card-body">
    <div class="mb-3">
      <input type="text" class="form-control" id="searchPermissions" placeholder="Search permissions...">
    </div>
    <div id="permissionsTableContainer">
      <div class="text-center">
        <div class="loading"></div>
      </div>
    </div>
  </div>
</div>

<script>
  async function loadPermissions() {
    try {
      const data = await fetchAPI(API_BASE + '/permissions?page=1&limit=100');
      const permissions = data.data || [];

      let html = '<table class="table table-hover">';
      html += '<thead><tr><th>Name</th><th>Description</th><th>Group</th><th>Status</th><th>Actions</th></tr></thead><tbody>';

      permissions.forEach(perm => {
        const status = perm.status === 1 ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-danger">Inactive</span>';
        const groupName = perm.group?.label || '-';
        html += '<tr>';
        html += '<td><code>' + perm.dispName + '</code></td>';
        html += '<td>' + (perm.description || '-') + '</td>';
        html += '<td>' + groupName + '</td>';
        html += '<td>' + status + '</td>';
        html += '<td><button class="btn btn-sm btn-info" onclick="editPermission(' + perm.id + ')"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deletePermission(' + perm.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
      });

      html += '</tbody></table>';
      if (permissions.length === 0) {
        html = '<p class="text-center text-muted">No permissions found</p>';
      }

      document.getElementById('permissionsTableContainer').innerHTML = html;
    } catch (error) {
      document.getElementById('permissionsTableContainer').innerHTML = '<p class="text-danger">Error loading permissions</p>';
    }
  }

  function openCreatePermissionModal() {
    alert('Permission creation form would go here');
  }

  function editPermission(id) {
    alert('Edit permission ' + id);
  }

  function deletePermission(id) {
    if (confirm('Are you sure?')) {
      alert('Delete permission ' + id);
    }
  }

  document.addEventListener('DOMContentLoaded', loadPermissions);
</script>
` }) %>
