<%- include('../../layout', { title: 'Permission Groups', currentPage: 'permission-groups', body: `
<div class="page-header">
  <h1><i class="fas fa-folder-lock"></i> Permission Groups</h1>
  <p>Organize permissions into logical groups</p>
</div>

<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">Groups</h5>
    <button class="btn btn-primary btn-sm" onclick="openCreateGroupModal()">
      <i class="fas fa-plus"></i> New Group
    </button>
  </div>
  <div class="card-body">
    <div class="mb-3">
      <input type="text" class="form-control" id="searchGroups" placeholder="Search groups...">
    </div>
    <div id="groupsTableContainer">
      <div class="text-center">
        <div class="loading"></div>
      </div>
    </div>
  </div>
</div>

<script>
  async function loadGroups() {
    try {
      const data = await fetchAPI(API_BASE + '/permission-groups?page=1&limit=50');
      const groups = data.data || [];

      let html = '<table class="table table-hover">';
      html += '<thead><tr><th>Name</th><th>Description</th><th>Permissions</th><th>Status</th><th>Actions</th></tr></thead><tbody>';

      groups.forEach(group => {
        const status = group.status === 1 ? '<span class="badge bg-success">Active</span>' : '<span class="badge bg-danger">Inactive</span>';
        const permCount = group.permissions?.length || 0;
        html += '<tr>';
        html += '<td><strong>' + group.label + '</strong></td>';
        html += '<td>' + (group.description || '-') + '</td>';
        html += '<td><span class="badge bg-secondary">' + permCount + '</span></td>';
        html += '<td>' + status + '</td>';
        html += '<td><button class="btn btn-sm btn-info" onclick="editGroup(' + group.id + ')"><i class="fas fa-edit"></i></button> <button class="btn btn-sm btn-danger" onclick="deleteGroup(' + group.id + ')"><i class="fas fa-trash"></i></button></td>';
        html += '</tr>';
      });

      html += '</tbody></table>';
      if (groups.length === 0) {
        html = '<p class="text-center text-muted">No groups found</p>';
      }

      document.getElementById('groupsTableContainer').innerHTML = html;
    } catch (error) {
      document.getElementById('groupsTableContainer').innerHTML = '<p class="text-danger">Error loading groups</p>';
    }
  }

  function openCreateGroupModal() {
    alert('Group creation form would go here');
  }

  function editGroup(id) {
    alert('Edit group ' + id);
  }

  function deleteGroup(id) {
    if (confirm('Are you sure?')) {
      alert('Delete group ' + id);
    }
  }

  document.addEventListener('DOMContentLoaded', loadGroups);
</script>
` }) %>
